<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Visualisation of New Year Resolutions for 2015</title>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>

    <style type="text/css">
        /*css for the different category checkboxes*/
        .category_checkbox {

        }

        /*css for the different gender checkboxes*/
        .gender_checkbox {

        }

        /*css for the different categories*/
        .health {
            fill: red;
        }
        .humor {
            fill: blue;
        }
        .personal {
            fill: purple;
        }
        .philanthropic {
            fill: yellow;
        }
        .education {
            fill: burlyWood;
        }
        .recreation {
            fill: orange;
        }
        .family {
            fill: green;
        }
        .career
        {
            fill: deepPink;
        }
        .finance {
            fill: aqua;
        }
        .time{
            fill: navy;
        }

        /*css for tooltips on map*/

        #tooltip {
            position: absolute;
            width: 300px;
            height: auto;
            padding: 10px;
            background-color: white;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0,0,0,0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0,0,0,0.4);
            box-shadow: 4px 4px 10px rgba(0,0,0,0.4);
            pointer-events: none;
            opacity: 0.65;
        }

        #tooltip.hidden {
            display: none;
        }

        #tooltip p {
            margin: 0;
            font-family: sans-serif;
            font-size: 16px;
            line-height: 20px;
        }
    </style>
</head>
<body style="text-align: center">
    <div id="tooltip" class="hidden">
        <p><strong>Handle:@</strong><span id="tweet_handle">@something</span></p>
        <p><strong>Gender:</strong><span id="gender">male/female</span></p>
        <p><strong>Tweet:</strong><span id="tweet">#whatever this is life</span></p>
        <p><strong>Category:</strong><span id="category">Sample category</span></p>
        <p><strong>Topic:</strong><span id="topic">Sample topic</span></p>
        <p><strong>Location:</strong><span id="location">Sample location</span></p>
    </div>

    <form action="">
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Health & Fitness">Health & Fitness
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Humor">Humor
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Personal Growth">Personal Growth
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Philanthropic">Philanthropic
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Education/Training">Education/Training
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Recreation & Leisure">Recreation & Leisure
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Family/Friends/Relationships">Family/Friends/Relationships
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Career">Career
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Finance">Finance
        <input class="category_checkbox" type="checkbox" name="category" checked="true" value="Time Management/Organization">Time Management/Organization
    </form>

    <form>
        <input class="gender_checkbox" type="checkbox" name="gender" checked="true" value="male">Male
        <input class="gender_checkbox" type="checkbox" name="gender" checked="true" value="female">Female
    </form>

    <script>
        //width and height
        var width = 960;
        var height = 600;

        //define the map projection
        var projection = d3.geo.albersUsa()
                .scale(1280)
                .translate([width/2, height/2]);

        // define default path generator
        var path = d3.geo.path()
                .projection(projection);

        //create the svg element
        var svg = d3.select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height);


        // load the compiled data
        d3.csv("compilation.csv", function(data)
        {
            // load the GeoJSON data for the states
            d3.json("us-states.json", function(json){
                //bind data and create one path per GeoJSON feature
                svg.selectAll("path")
                        .data(json.features)
                        .enter()
                        .append("path")
                        .attr("d", path)
                        .style("fill","cccccc")
                        .style("stroke", "white");

                //set up circles for the different locations
                svg.selectAll("circle")
                        .data(data)
                        .enter()
                        .append("circle")
                        .attr("cx", function(d){
                            return projection([d.long, d.lat])[0];
                        })
                        .attr("cy", function(d){
                            return projection([d.long, d.lat])[1];
                        })
                        .attr("r", 5)
                        .style("fill", function(d) {
                            return selectCategoryColour(d.category);
                        })
                        .style("opacity", 0.75)
                        .on("mouseover", function(d){
                            // what happens when a point is hovered over

                            //obtain x and y values for the tooltip to appear
                            var xPosition = parseFloat(d3.select(this).attr("cx"));
                            var yPosition = parseFloat(d3.select(this).attr("cy"));

                            //update the tooltip position and values
                            d3.select("#tooltip")
                                    .style("left", xPosition + "px")
                                    .style("top", yPosition + "px");

                            //fill in the fields in the tooltip
                            d3.select("#tooltip")
                                    .select("#tweet_handle")
                                    .text(d.handle);

                            d3.select("#tooltip")
                                    .select("#gender")
                                    .text(d.gender);

                            d3.select("#tooltip")
                                    .select("#tweet")
                                    .text(d.tweet);

                            d3.select("#tooltip")
                                    .select("#category")
                                    .text(d.category);

                            d3.select("#tooltip")
                                    .select("#topic")
                                    .text(d.topic);

                            d3.select("#tooltip")
                                    .select("#location")
                                    .text(d.location);

                            //show the tooltip
                            d3.select("#tooltip").classed("hidden", false);

                            //set the color of the circle
                            d3.select(this)
                                    .attr("r", 10)
                                    .style("fill", function(d){
                                        return selectCategoryColour("");
                                    });
                        })
                        .on("mouseout", function(){
                            //what happens when overing over a point is done
                            //hide the tooltip
                            d3.select("#tooltip").classed("hidden", true);

                            //set back to the original colour for the point
                            d3.select(this)
                                    .attr("r", 5)
                                    .style("fill", function(d){
                                        return selectCategoryColour(d.category);
                                    });
                        });

                //adding listener to each category checkbox
                d3.selectAll(".category_checkbox")
                        .on("change", function() {
                            var checkboxValue = this.value;
                            var points = svg.selectAll("circle")
                                    .filter(function(d) {
                                        return d.category == checkboxValue;
                                    });

                            //display only those points that have been ticked
                            if(this.checked)
                            {
                                //checked gender boxes to get the current picked genders
                                var checkedGenders = d3.selectAll(".gender_checkbox")
                                        .filter(function(){
                                            return this.checked;
                                        });

                                checkedGenders.each(function(){
                                    var checkboxGender = this.value;
                                    //filter to return points that satisfy the picked gender
                                    var tempPoints = points.filter(function(point){
                                        return point.gender == checkboxGender;
                                    });
                                    tempPoints.style("display", "inline");
                                });
                            }
                            else
                            {
                                points.style("display", "none");
                            }
                        });

                //adding listener to each gender checkbox
                d3.selectAll(".gender_checkbox")
                        .on("change", function(){
                            var checkboxValue = this.value;
                            var points = svg.selectAll("circle")
                                    .filter(function(d){
                                        return d.gender == checkboxValue;
                                    });
                            //display only those points that have been ticked
                            if(this.checked)
                            {
                                //checked category boxes to get the current picked categories
                                var checkedCategories = d3.selectAll(".category_checkbox")
                                        .filter(function(){
                                            return this.checked;
                                        });

                                checkedCategories.each(function(){
                                    var checkboxCategory = this.value;
                                    //filter to return points that satisfy the picked categories
                                    var tempPoints = points.filter(function(point){
                                        return point.category == checkboxCategory;
                                    });
                                    tempPoints.style("display", "inline");
                                });
                                //points.style("display", "inline");
                            }
                            else
                            {
                                points.style("display", "none");
                            }
                        });
            });
        });

        function selectCategoryColour(category)
        {
            var color;

            switch(category)
            {
                case "Health & Fitness":
                    color = "red";
                    break;
                case "Humor":
                    color = "blue";
                    break;
                case "Personal Growth":
                    color = "purple";
                    break;
                case "Philanthropic":
                    color = "yellow";
                    break;
                case "Education/Training":
                    color = "burlyWood";
                    break;
                case "Recreation & Leisure":
                    color = "orange";
                    break;
                case "Family/Friends/Relationships":
                    color = "green";
                    break;
                case "Career":
                    color = "deepPink";
                    break;
                case "Finance":
                    color = "aqua";
                    break;
                case "Time Management/Organization":
                    color = "navy";
                    break;
                default:
                    color = "black";
            }
            return color;
        }

    </script>
</body>
</html>